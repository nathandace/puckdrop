@page "/webhooks"
@using PuckDrop.Models.Domain
@using PuckDrop.Services
@inject IWebhookRuleService WebhookRuleService
@inject IWebhookDispatchService WebhookDispatchService
@inject ITeamService TeamService
@rendermode InteractiveServer

<PageTitle>Webhook Configuration - NHL Monitor</PageTitle>

<div class="webhooks-page">
    <div class="page-header">
        <h1>Webhook Configuration</h1>
        <p class="text-muted">Configure webhooks to receive notifications for game events</p>
    </div>

    @if (_isLoading)
    {
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>Loading webhook rules...</p>
        </div>
    }
    else
    {
        <div class="webhooks-content">
            <div class="rules-section">
                <div class="section-header">
                    <h2>Webhook Rules</h2>
                    <button class="btn btn-primary" @onclick="ShowCreateModal">
                        <span class="icon">+</span> Add Rule
                    </button>
                </div>

                @if (_rules.Count == 0)
                {
                    <div class="empty-state">
                        <div class="empty-icon">&#128276;</div>
                        <h3>No Webhook Rules</h3>
                        <p>Create your first webhook rule to receive notifications for game events.</p>
                        <button class="btn btn-primary" @onclick="ShowCreateModal">Create Rule</button>
                    </div>
                }
                else
                {
                    <div class="rules-list">
                        @foreach (var rule in _rules)
                        {
                            <div class="rule-card @(rule.IsEnabled ? "" : "disabled")">
                                <div class="rule-header">
                                    <div class="rule-info">
                                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                            <img src="@TeamLogoHelper.GetLogoUrl(rule.TeamAbbrev)" alt="@rule.TeamAbbrev" class="team-logo-sm" />
                                            <h3>@(string.IsNullOrEmpty(rule.Name) ? GetEventTypeDisplayName(rule.EventType) : rule.Name)</h3>
                                        </div>
                                        <div style="display: flex; gap: var(--spacing-sm); margin-top: var(--spacing-xs);">
                                            <span class="badge">@rule.TeamAbbrev</span>
                                            <span class="event-badge @GetEventBadgeClass(rule.EventType)">
                                                @GetEventTypeDisplayName(rule.EventType)
                                            </span>
                                        </div>
                                    </div>
                                    <div class="rule-status">
                                        <label class="toggle-switch">
                                            <input type="checkbox" checked="@rule.IsEnabled" @onchange="() => ToggleRuleEnabled(rule)" />
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="rule-details">
                                    <div class="detail-row">
                                        <span class="label">Target URL:</span>
                                        <span class="value url">@TruncateUrl(rule.TargetUrl)</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="label">Format:</span>
                                        <span class="value format-badge @rule.PayloadFormat.ToString().ToLower()">
                                            @rule.PayloadFormat
                                        </span>
                                        @if (rule.DelaySeconds > 0)
                                        {
                                            <span class="value delay-badge">@(rule.DelaySeconds)s delay</span>
                                        }
                                    </div>
                                </div>
                                <div class="rule-actions">
                                    <button class="btn btn-secondary btn-sm" @onclick="() => ShowPayloadPreview(rule)">
                                        Preview Payload
                                    </button>
                                    <button class="btn btn-secondary btn-sm" @onclick="() => TestRule(rule)" disabled="@_testingRuleId.HasValue">
                                        @if (_testingRuleId == rule.Id)
                                        {
                                            <span class="loading-dots">Testing...</span>
                                        }
                                        else
                                        {
                                            <span>Test</span>
                                        }
                                    </button>
                                    <button class="btn btn-secondary btn-sm" @onclick="() => ShowEditModal(rule)">Edit</button>
                                    <button class="btn btn-danger btn-sm" @onclick="() => ShowDeleteConfirm(rule)">Delete</button>
                                </div>
                                @if (_testResults.TryGetValue(rule.Id, out var result))
                                {
                                    <div class="test-result @(result.Success ? "success" : "error")">
                                        @result.Message
                                    </div>
                                }
                            </div>
                        }
                    </div>
                }
            </div>

            <div class="info-section">
                <h2>Event Types</h2>
                <div class="event-types-grid">
                    @foreach (var eventType in Enum.GetValues<WebhookEventType>())
                    {
                        <div class="event-type-card">
                            <span class="event-icon">@GetEventTypeIcon(eventType)</span>
                            <span class="event-name">@GetEventTypeDisplayName(eventType)</span>
                        </div>
                    }
                </div>

                <h2>Payload Formats</h2>
                <div class="format-info">
                    <div class="format-card">
                        <h4>Generic JSON</h4>
                        <p>Standard JSON payload with all event data. Use for custom integrations.</p>
                    </div>
                    <div class="format-card">
                        <h4>Discord</h4>
                        <p>Formatted embed message for Discord webhooks with colors and rich formatting.</p>
                    </div>
                    <div class="format-card">
                        <h4>Home Assistant</h4>
                        <p>Event format compatible with Home Assistant webhook triggers.</p>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@if (_showModal)
{
    <div class="modal-overlay" @onclick="CloseModal">
        <div class="modal-content" @onclick:stopPropagation="true">
            <div class="modal-header">
                <h2>@(_editingRule == null ? "Create Webhook Rule" : "Edit Webhook Rule")</h2>
                <button class="modal-close" @onclick="CloseModal">&times;</button>
            </div>
            <div class="modal-body">
                <EditForm Model="_formModel" OnValidSubmit="SaveRule">
                    <DataAnnotationsValidator />

                    <div class="form-group">
                        <label for="name">Name (Optional)</label>
                        <InputText id="name" @bind-Value="_formModel.Name" class="form-control" placeholder="My Webhook Rule" />
                    </div>

                    <div class="form-group">
                        <label for="teamAbbrev">Team to Monitor</label>
                        <InputSelect id="teamAbbrev" @bind-Value="_formModel.TeamAbbrev" class="form-control">
                            <option value="">-- Select Team --</option>
                            @foreach (var team in _allTeams)
                            {
                                <option value="@team.Abbrev">@team.Name</option>
                            }
                        </InputSelect>
                        <ValidationMessage For="() => _formModel.TeamAbbrev" />
                    </div>

                    <div class="form-group">
                        <label for="eventType">Event Type</label>
                        <InputSelect id="eventType" @bind-Value="_formModel.EventType" class="form-control">
                            @foreach (var eventType in Enum.GetValues<WebhookEventType>())
                            {
                                <option value="@eventType">@GetEventTypeDisplayName(eventType)</option>
                            }
                        </InputSelect>
                    </div>

                    <div class="form-group">
                        <label for="targetUrl">Target URL</label>
                        <InputText id="targetUrl" @bind-Value="_formModel.TargetUrl" class="form-control" placeholder="https://..." />
                        <ValidationMessage For="() => _formModel.TargetUrl" />
                    </div>

                    <div class="form-group">
                        <label for="payloadFormat">Payload Format</label>
                        <InputSelect id="payloadFormat" @bind-Value="_formModel.PayloadFormat" class="form-control">
                            @foreach (var format in Enum.GetValues<WebhookPayloadFormat>())
                            {
                                <option value="@format">@format</option>
                            }
                        </InputSelect>
                    </div>

                    <div class="form-group">
                        <label for="delaySeconds">Delay (seconds)</label>
                        <InputNumber id="delaySeconds" @bind-Value="_formModel.DelaySeconds" class="form-control" min="0" max="120" />
                        <small class="form-hint">
                            Delay before sending webhook. Use this to sync with broadcast/streaming delay (0-120 seconds).
                        </small>
                    </div>

                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <InputCheckbox @bind-Value="_formModel.IsEnabled" />
                            <span>Enabled</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <InputCheckbox @bind-Value="_formModel.UseCustomTemplate" />
                            <span>Use Custom Payload Template</span>
                        </label>
                    </div>

                    @if (_formModel.UseCustomTemplate)
                    {
                        <div class="form-group">
                            <label for="customTemplate">Custom JSON Template</label>
                            <InputTextArea id="customTemplate" @bind-Value="_formModel.CustomPayloadTemplate"
                                class="form-control code-editor" rows="10"
                                placeholder='{"team_colors": {{team_colors}}, "event": "{{eventType}}", "team": "{{team}}"}'/>
                            <small class="form-hint">
                                Available placeholders: <code>{{eventType}}</code>, <code>{{team}}</code>, <code>{{player}}</code>,
                                <code>{{homeTeam}}</code>, <code>{{awayTeam}}</code>, <code>{{homeScore}}</code>, <code>{{awayScore}}</code>,
                                <code>{{period}}</code>, <code>{{timeInPeriod}}</code>, <code>{{team_colors}}</code>,
                                <code>{{payload}}</code> (full JSON)
                            </small>
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(_formError))
                    {
                        <div class="form-error">@_formError</div>
                    }

                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" @onclick="CloseModal">Cancel</button>
                        <button type="submit" class="btn btn-primary" disabled="@_isSaving">
                            @if (_isSaving)
                            {
                                <span>Saving...</span>
                            }
                            else
                            {
                                <span>@(_editingRule == null ? "Create" : "Save")</span>
                            }
                        </button>
                    </div>
                </EditForm>
            </div>
        </div>
    </div>
}

@if (_showDeleteConfirm)
{
    <div class="modal-overlay" @onclick="CloseDeleteConfirm">
        <div class="modal-content modal-sm" @onclick:stopPropagation="true">
            <div class="modal-header">
                <h2>Delete Webhook Rule</h2>
                <button class="modal-close" @onclick="CloseDeleteConfirm">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this webhook rule?</p>
                @if (_deletingRule != null)
                {
                    <p class="text-muted">
                        @(string.IsNullOrEmpty(_deletingRule.Name) ? $"{_deletingRule.TeamAbbrev} - {GetEventTypeDisplayName(_deletingRule.EventType)}" : _deletingRule.Name)
                    </p>
                }
                <div class="modal-actions">
                    <button class="btn btn-secondary" @onclick="CloseDeleteConfirm">Cancel</button>
                    <button class="btn btn-danger" @onclick="ConfirmDelete" disabled="@_isDeleting">
                        @if (_isDeleting)
                        {
                            <span>Deleting...</span>
                        }
                        else
                        {
                            <span>Delete</span>
                        }
                    </button>
                </div>
            </div>
        </div>
    </div>
}

@if (_showPayloadPreview)
{
    <div class="modal-overlay" @onclick="ClosePayloadPreview">
        <div class="modal-content modal-lg" @onclick:stopPropagation="true">
            <div class="modal-header">
                <h2>Payload Preview</h2>
                <button class="modal-close" @onclick="ClosePayloadPreview">&times;</button>
            </div>
            <div class="modal-body">
                @if (_previewingRule != null)
                {
                    <div class="payload-info">
                        <span class="badge">@_previewingRule.TeamAbbrev</span>
                        <span class="event-badge @GetEventBadgeClass(_previewingRule.EventType)">
                            @GetEventTypeDisplayName(_previewingRule.EventType)
                        </span>
                        <span class="format-badge @_previewingRule.PayloadFormat.ToString().ToLower()">
                            @_previewingRule.PayloadFormat
                        </span>
                        @if (!string.IsNullOrEmpty(_previewingRule.CustomPayloadTemplate))
                        {
                            <span class="badge custom">Custom Template</span>
                        }
                    </div>
                    <pre class="payload-preview"><code>@_payloadPreviewJson</code></pre>
                    <p class="text-muted" style="margin-top: var(--spacing-md);">
                        This is a sample payload showing what will be sent when an event is triggered.
                        The <code>team_colors</code> array contains RGB values for LED/smart home integrations.
                    </p>
                }
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" @onclick="ClosePayloadPreview">Close</button>
            </div>
        </div>
    </div>
}

@code {
    private List<WebhookRule> _rules = new();
    private List<NhlTeamInfo> _allTeams = new();
    private bool _isLoading = true;
    private bool _showModal;
    private bool _showDeleteConfirm;
    private bool _showPayloadPreview;
    private bool _isSaving;
    private bool _isDeleting;
    private int? _testingRuleId;
    private string? _formError;
    private WebhookRule? _editingRule;
    private WebhookRule? _deletingRule;
    private WebhookRule? _previewingRule;
    private string? _payloadPreviewJson;
    private WebhookRuleFormModel _formModel = new();
    private Dictionary<int, TestResult> _testResults = new();

    /// <summary>
    /// Initializes the component and loads webhook rules.
    /// </summary>
    protected override async Task OnInitializedAsync()
    {
        await LoadDataAsync();
    }

    /// <summary>
    /// Loads all data including teams and webhook rules.
    /// </summary>
    private async Task LoadDataAsync()
    {
        _isLoading = true;
        try
        {
            _allTeams = await TeamService.GetAllTeamsAsync();
            _rules = await WebhookRuleService.GetAllRulesAsync();
        }
        finally
        {
            _isLoading = false;
        }
    }

    /// <summary>
    /// Loads all webhook rules from the database.
    /// </summary>
    private async Task LoadRulesAsync()
    {
        _rules = await WebhookRuleService.GetAllRulesAsync();
    }

    /// <summary>
    /// Shows the create rule modal.
    /// </summary>
    private void ShowCreateModal()
    {
        _editingRule = null;
        _formModel = new WebhookRuleFormModel
        {
            TeamAbbrev = _allTeams.FirstOrDefault()?.Abbrev ?? "",
            EventType = WebhookEventType.GoalScored,
            PayloadFormat = WebhookPayloadFormat.Generic,
            IsEnabled = true,
            DelaySeconds = 0
        };
        _formError = null;
        _showModal = true;
    }

    /// <summary>
    /// Shows the edit rule modal.
    /// </summary>
    /// <param name="rule">The rule to edit.</param>
    private void ShowEditModal(WebhookRule rule)
    {
        _editingRule = rule;
        _formModel = new WebhookRuleFormModel
        {
            Name = rule.Name,
            TeamAbbrev = rule.TeamAbbrev,
            EventType = rule.EventType,
            TargetUrl = rule.TargetUrl,
            PayloadFormat = rule.PayloadFormat,
            IsEnabled = rule.IsEnabled,
            DelaySeconds = rule.DelaySeconds,
            UseCustomTemplate = !string.IsNullOrEmpty(rule.CustomPayloadTemplate),
            CustomPayloadTemplate = rule.CustomPayloadTemplate
        };
        _formError = null;
        _showModal = true;
    }

    /// <summary>
    /// Closes the create/edit modal.
    /// </summary>
    private void CloseModal()
    {
        _showModal = false;
        _editingRule = null;
        _formError = null;
    }

    /// <summary>
    /// Saves the webhook rule.
    /// </summary>
    private async Task SaveRule()
    {
        if (string.IsNullOrWhiteSpace(_formModel.TeamAbbrev))
        {
            _formError = "Please select a team to monitor.";
            return;
        }

        if (string.IsNullOrWhiteSpace(_formModel.TargetUrl))
        {
            _formError = "Target URL is required.";
            return;
        }

        if (!Uri.TryCreate(_formModel.TargetUrl, UriKind.Absolute, out var uri) ||
            (uri.Scheme != "http" && uri.Scheme != "https"))
        {
            _formError = "Please enter a valid HTTP or HTTPS URL.";
            return;
        }

        _isSaving = true;
        _formError = null;

        try
        {
            var customTemplate = _formModel.UseCustomTemplate ? _formModel.CustomPayloadTemplate : null;

            if (_editingRule == null)
            {
                var newRule = new WebhookRule
                {
                    Name = _formModel.Name,
                    TeamAbbrev = _formModel.TeamAbbrev,
                    EventType = _formModel.EventType,
                    TargetUrl = _formModel.TargetUrl,
                    PayloadFormat = _formModel.PayloadFormat,
                    IsEnabled = _formModel.IsEnabled,
                    DelaySeconds = _formModel.DelaySeconds,
                    CustomPayloadTemplate = customTemplate
                };
                await WebhookRuleService.CreateRuleAsync(newRule);
            }
            else
            {
                _editingRule.Name = _formModel.Name;
                _editingRule.TeamAbbrev = _formModel.TeamAbbrev;
                _editingRule.EventType = _formModel.EventType;
                _editingRule.TargetUrl = _formModel.TargetUrl;
                _editingRule.PayloadFormat = _formModel.PayloadFormat;
                _editingRule.IsEnabled = _formModel.IsEnabled;
                _editingRule.DelaySeconds = _formModel.DelaySeconds;
                _editingRule.CustomPayloadTemplate = customTemplate;
                await WebhookRuleService.UpdateRuleAsync(_editingRule);
            }

            await LoadRulesAsync();
            CloseModal();
        }
        catch (Exception ex)
        {
            _formError = $"Failed to save rule: {ex.Message}";
        }
        finally
        {
            _isSaving = false;
        }
    }

    /// <summary>
    /// Shows the delete confirmation modal.
    /// </summary>
    /// <param name="rule">The rule to delete.</param>
    private void ShowDeleteConfirm(WebhookRule rule)
    {
        _deletingRule = rule;
        _showDeleteConfirm = true;
    }

    /// <summary>
    /// Closes the delete confirmation modal.
    /// </summary>
    private void CloseDeleteConfirm()
    {
        _showDeleteConfirm = false;
        _deletingRule = null;
    }

    /// <summary>
    /// Confirms and executes the rule deletion.
    /// </summary>
    private async Task ConfirmDelete()
    {
        if (_deletingRule == null)
        {
            return;
        }

        _isDeleting = true;

        try
        {
            await WebhookRuleService.DeleteRuleAsync(_deletingRule.Id);
            _testResults.Remove(_deletingRule.Id);
            await LoadRulesAsync();
            CloseDeleteConfirm();
        }
        finally
        {
            _isDeleting = false;
        }
    }

    /// <summary>
    /// Toggles the enabled state of a rule.
    /// </summary>
    /// <param name="rule">The rule to toggle.</param>
    private async Task ToggleRuleEnabled(WebhookRule rule)
    {
        rule.IsEnabled = !rule.IsEnabled;
        await WebhookRuleService.UpdateRuleAsync(rule);
    }

    /// <summary>
    /// Tests a webhook rule by sending a test payload.
    /// </summary>
    /// <param name="rule">The rule to test.</param>
    private async Task TestRule(WebhookRule rule)
    {
        _testingRuleId = rule.Id;
        _testResults.Remove(rule.Id);
        StateHasChanged();

        try
        {
            var success = await WebhookDispatchService.SendTestWebhookAsync(rule);
            _testResults[rule.Id] = new TestResult
            {
                Success = success,
                Message = success ? "Test webhook sent successfully!" : "Test webhook failed. Check your URL and try again."
            };
        }
        catch (Exception ex)
        {
            _testResults[rule.Id] = new TestResult
            {
                Success = false,
                Message = $"Error: {ex.Message}"
            };
        }
        finally
        {
            _testingRuleId = null;
        }
    }

    /// <summary>
    /// Shows the payload preview modal for a rule.
    /// </summary>
    /// <param name="rule">The rule to preview.</param>
    private void ShowPayloadPreview(WebhookRule rule)
    {
        _previewingRule = rule;
        try
        {
            var json = WebhookDispatchService.GetPayloadPreview(rule);
            // Pretty print the JSON
            var options = new System.Text.Json.JsonSerializerOptions { WriteIndented = true };
            var parsed = System.Text.Json.JsonDocument.Parse(json);
            _payloadPreviewJson = System.Text.Json.JsonSerializer.Serialize(parsed, options);
        }
        catch (Exception ex)
        {
            _payloadPreviewJson = $"Error generating preview: {ex.Message}";
        }
        _showPayloadPreview = true;
    }

    /// <summary>
    /// Closes the payload preview modal.
    /// </summary>
    private void ClosePayloadPreview()
    {
        _showPayloadPreview = false;
        _previewingRule = null;
        _payloadPreviewJson = null;
    }

    /// <summary>
    /// Gets the display name for an event type.
    /// </summary>
    /// <param name="eventType">The event type.</param>
    /// <returns>The display name.</returns>
    private static string GetEventTypeDisplayName(WebhookEventType eventType)
    {
        return eventType switch
        {
            WebhookEventType.GoalScored => "Goal Scored",
            WebhookEventType.PenaltyCommitted => "Penalty",
            WebhookEventType.PowerPlayStart => "Power Play Start",
            WebhookEventType.PowerPlayEnd => "Power Play End",
            WebhookEventType.GoaliePulled => "Goalie Pulled",
            WebhookEventType.GoalieReturned => "Goalie Returned",
            WebhookEventType.PeriodStart => "Period Start",
            WebhookEventType.PeriodEnd => "Period End",
            WebhookEventType.GameEnd => "Game End",
            WebhookEventType.GameStart => "Game Start",
            _ => eventType.ToString()
        };
    }

    /// <summary>
    /// Gets the icon for an event type.
    /// </summary>
    /// <param name="eventType">The event type.</param>
    /// <returns>The icon character.</returns>
    private static string GetEventTypeIcon(WebhookEventType eventType)
    {
        return eventType switch
        {
            WebhookEventType.GoalScored => "\U0001F3D2",
            WebhookEventType.PenaltyCommitted => "\U0001F6A8",
            WebhookEventType.PowerPlayStart => "\u26A1",
            WebhookEventType.PowerPlayEnd => "\u23F9",
            WebhookEventType.GoaliePulled => "\U0001F94A",
            WebhookEventType.GoalieReturned => "\U0001F3D1",
            WebhookEventType.PeriodStart => "\u25B6",
            WebhookEventType.PeriodEnd => "\u23F8",
            WebhookEventType.GameEnd => "\U0001F3C6",
            WebhookEventType.GameStart => "\U0001F3D2",
            _ => "\U0001F514"
        };
    }

    /// <summary>
    /// Gets the CSS class for an event type badge.
    /// </summary>
    /// <param name="eventType">The event type.</param>
    /// <returns>The CSS class.</returns>
    private static string GetEventBadgeClass(WebhookEventType eventType)
    {
        return eventType switch
        {
            WebhookEventType.GoalScored => "goal",
            WebhookEventType.PenaltyCommitted => "penalty",
            WebhookEventType.PowerPlayStart or WebhookEventType.PowerPlayEnd => "powerplay",
            WebhookEventType.GoaliePulled or WebhookEventType.GoalieReturned => "goalie",
            WebhookEventType.PeriodStart or WebhookEventType.PeriodEnd => "period",
            WebhookEventType.GameStart => "game-start",
            WebhookEventType.GameEnd => "game-end",
            _ => ""
        };
    }

    /// <summary>
    /// Truncates a URL for display.
    /// </summary>
    /// <param name="url">The URL to truncate.</param>
    /// <returns>The truncated URL.</returns>
    private static string TruncateUrl(string url)
    {
        if (string.IsNullOrEmpty(url))
        {
            return string.Empty;
        }

        if (url.Length <= 50)
        {
            return url;
        }

        return url.Substring(0, 47) + "...";
    }

    /// <summary>
    /// Form model for webhook rule creation/editing.
    /// </summary>
    private class WebhookRuleFormModel
    {
        /// <summary>
        /// Gets or sets the rule name.
        /// </summary>
        public string? Name { get; set; }

        /// <summary>
        /// Gets or sets the team abbreviation.
        /// </summary>
        public string TeamAbbrev { get; set; } = string.Empty;

        /// <summary>
        /// Gets or sets the event type.
        /// </summary>
        public WebhookEventType EventType { get; set; }

        /// <summary>
        /// Gets or sets the target URL.
        /// </summary>
        public string TargetUrl { get; set; } = string.Empty;

        /// <summary>
        /// Gets or sets the payload format.
        /// </summary>
        public WebhookPayloadFormat PayloadFormat { get; set; }

        /// <summary>
        /// Gets or sets whether the rule is enabled.
        /// </summary>
        public bool IsEnabled { get; set; }

        /// <summary>
        /// Gets or sets the delay in seconds before sending the webhook.
        /// </summary>
        public int DelaySeconds { get; set; }

        /// <summary>
        /// Gets or sets whether to use a custom payload template.
        /// </summary>
        public bool UseCustomTemplate { get; set; }

        /// <summary>
        /// Gets or sets the custom JSON payload template.
        /// </summary>
        public string? CustomPayloadTemplate { get; set; }
    }

    /// <summary>
    /// Result of a webhook test.
    /// </summary>
    private class TestResult
    {
        /// <summary>
        /// Gets or sets whether the test was successful.
        /// </summary>
        public bool Success { get; set; }

        /// <summary>
        /// Gets or sets the result message.
        /// </summary>
        public string Message { get; set; } = string.Empty;
    }
}
