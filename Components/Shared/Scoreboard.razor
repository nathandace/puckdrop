@using PuckDrop.Models.Api
@using PuckDrop.Services

<div class="scoreboard">
    <div style="display: flex; align-items: center; justify-content: center; gap: var(--spacing-xl);">
        <!-- Away Team -->
        <a href="/team/@AwayTeam?.Abbrev" class="team-logo-link" style="text-align: center; text-decoration: none; color: inherit;">
            <img src="@TeamLogoHelper.GetLogoUrl(AwayTeam?.Abbrev)" alt="@AwayTeam?.Abbrev" class="team-logo-lg" />
            <div style="font-size: 0.875rem; margin-top: var(--spacing-xs);">@AwayTeam?.Abbrev</div>
            @if (AwaySituation != null && !string.IsNullOrEmpty(AwaySituation.SituationDescriptor))
            {
                <div class="power-play-indicator">@AwaySituation.SituationDescriptor (@AwaySituation.Strength)v@(HomeSituation?.Strength ?? 5)</div>
            }
        </a>

        <!-- Score -->
        <div style="text-align: center;">
            <div class="score-display">
                <span class="score-away">@(AwayTeam?.Score ?? 0)</span>
                <span class="score-separator">-</span>
                <span class="score-home">@(HomeTeam?.Score ?? 0)</span>
            </div>

            @if (Clock != null && PeriodDescriptor != null)
            {
                <div class="period-display">
                    @GetPeriodText(PeriodDescriptor)
                </div>
                @if (!Clock.InIntermission)
                {
                    <div class="time-display">@Clock.TimeRemaining</div>
                }
                else
                {
                    <div class="time-display text-muted">Intermission</div>
                }
            }
            else if (GameState == "FUT" || GameState == "PRE")
            {
                <div class="period-display">@StartTime.ToLocalTime().ToString("h:mm tt")</div>
                <div class="text-muted">@StartTime.ToLocalTime().ToString("MMM d, yyyy")</div>
            }
            else if (GameState == "FINAL" || GameState == "OFF")
            {
                <div class="period-display">FINAL@GetOvertimeIndicator()</div>
            }
        </div>

        <!-- Home Team -->
        <a href="/team/@HomeTeam?.Abbrev" class="team-logo-link" style="text-align: center; text-decoration: none; color: inherit;">
            <img src="@TeamLogoHelper.GetLogoUrl(HomeTeam?.Abbrev)" alt="@HomeTeam?.Abbrev" class="team-logo-lg" />
            <div style="font-size: 0.875rem; margin-top: var(--spacing-xs);">@HomeTeam?.Abbrev</div>
            @if (HomeSituation != null && !string.IsNullOrEmpty(HomeSituation.SituationDescriptor))
            {
                <div class="power-play-indicator">@HomeSituation.SituationDescriptor (@HomeSituation.Strength)v@(AwaySituation?.Strength ?? 5)</div>
            }
        </a>
    </div>

    <!-- Team Stats -->
    @if (AwayTeam != null && HomeTeam != null)
    {
        <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: var(--spacing-lg); margin-top: var(--spacing-xl); padding-top: var(--spacing-lg); border-top: 1px solid var(--border-color);">
            <div class="text-right font-mono">@AwayTeam.Sog</div>
            <div class="text-muted text-center">SOG</div>
            <div class="font-mono">@HomeTeam.Sog</div>
        </div>
    }
</div>

@code {
    /// <summary>
    /// Gets or sets the away team data.
    /// </summary>
    [Parameter]
    public LandingTeam? AwayTeam { get; set; }

    /// <summary>
    /// Gets or sets the home team data.
    /// </summary>
    [Parameter]
    public LandingTeam? HomeTeam { get; set; }

    /// <summary>
    /// Gets or sets the game clock.
    /// </summary>
    [Parameter]
    public GameClock? Clock { get; set; }

    /// <summary>
    /// Gets or sets the period descriptor.
    /// </summary>
    [Parameter]
    public PeriodDescriptor? PeriodDescriptor { get; set; }

    /// <summary>
    /// Gets or sets the game state.
    /// </summary>
    [Parameter]
    public string? GameState { get; set; }

    /// <summary>
    /// Gets or sets the game start time.
    /// </summary>
    [Parameter]
    public DateTime StartTime { get; set; }

    /// <summary>
    /// Gets or sets the away team situation.
    /// </summary>
    [Parameter]
    public SituationTeam? AwaySituation { get; set; }

    /// <summary>
    /// Gets or sets the home team situation.
    /// </summary>
    [Parameter]
    public SituationTeam? HomeSituation { get; set; }

    /// <summary>
    /// Gets or sets the game outcome.
    /// </summary>
    [Parameter]
    public GameOutcome? GameOutcome { get; set; }

    /// <summary>
    /// Gets the period display text.
    /// </summary>
    /// <param name="period">The period descriptor.</param>
    /// <returns>Period display text.</returns>
    private static string GetPeriodText(PeriodDescriptor period)
    {
        if (period.PeriodType == "OT")
        {
            return period.Number > 4 ? $"{period.Number - 3}OT" : "OT";
        }
        if (period.PeriodType == "SO")
        {
            return "SO";
        }
        return $"P{period.Number}";
    }

    /// <summary>
    /// Gets the overtime indicator for final games.
    /// </summary>
    /// <returns>Overtime indicator string.</returns>
    private string GetOvertimeIndicator()
    {
        if (GameOutcome == null)
        {
            return "";
        }
        if (GameOutcome.LastPeriodType == "OT")
        {
            return "/OT";
        }
        if (GameOutcome.LastPeriodType == "SO")
        {
            return "/SO";
        }
        return "";
    }
}
